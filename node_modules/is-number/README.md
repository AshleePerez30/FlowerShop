         extensionGUID: await (0,_id_background_index__WEBPACK_IMPORTED_MODULE_1__/* .getUserId */ .n)(),
          licenseId: _check__WEBPACK_IMPORTED_MODULE_3__/* .License.get */ .Cz.get().licenseId,
          commitVersion: syncCommitVersion,
          force: forceParam,
          extInfo: getExtensionInfo(),
        }),
      },
    })
      .then(async (response) => {
        if (response.ok && typeof successCallback === 'function') {
          const text = await response.text();
          successCallback(text, response.status);
        }
        if (!response.ok) {
          (0,_utilities_background_index__WEBPACK_IMPORTED_MODULE_8__/* .log */ .cM)('sync server returned error, status', response.status);
          if (response.status === 304) {
            (0,_utilities_background_index__WEBPACK_IMPORTED_MODULE_8__/* .log */ .cM)('response', response);
            return;
          }
          if ((response.status !== 404 || response.status !== 403) && attemptCount < 3) {
            setTimeout(() => {
              requestSyncData(successCallback, errorCallback, attemptCount, shouldForce);
            }, 1000); // wait 1 second for retry
            return;
          }
          if (typeof errorCallback === 'function') {
            const responseObj = await response.json();
            errorCallback(response.status, response.status, responseObj);
          }
        }
      })
      .catch((error) => {
        (0,_utilities_background_index__WEBPACK_IMPORTED_MODULE_8__/* .log */ .cM)('sync server returned error: ', error);
        errorCallback(error.message);
      });
  };

  _prefs_background__WEBPACK_IMPORTED_MODULE_6__/* .settings.onload */ .Xd.onload().then(() => {
    _check__WEBPACK_IMPORTED_MODULE_3__/* .License.ready */ .Cz.ready().then(() => {
      if ((0,_prefs_background__WEBPACK_IMPORTED_MODULE_6__/* .getSettings */ .Gw)().sync_settings) {
        browser.storage.local.get(syncCommitVersionKey).then((response) => {
          syncCommitVersion = response[syncCommitVersionKey] || 0;
          browser.storage.local.get(syncPendingPostDataKey).then((postDataResponse) => {
            pendingPostData = postDataResponse[syncPendingPostDataKey] || false;
            processEventChangeRequest();
            enableSync();
            migrateSyncLog();
          });
        });
      }

      browser.storage.local.get(syncExtensionNameKey).then((response) => {
        currentExtensionName = response[syncExtensionNameKey] || '';
      });
    });
  });

  return {
    enableSync,
    disableSync,
    getSyncData,
    processFetchRequest,
    getCurrentExtensionName,
    getAllExtensionNames,
    setCurrentExtensionName,
    removeCurrentExtensionName,
    removeExtensionName,
    syncNotifier,
    getCommitVersion,
    setCommitVersion,
    getLastPostStatusCode,
    resetLastPostStatusCode,
    setLastPostStatusCode,
    getLastGetStatusCode,
    resetLastGetStatusCode,
    setLastGetStatusCode,
    getLastGetErrorResponse,
    resetLastGetErrorResponse,
    setLastGetErrorResponse,
    resetAllErrors,
    getSyncLog,
    deleteSyncLog,
    processUserSyncRequest,
    processEventChangeRequest,
    addSyncLogText,
  };
}());

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SyncService);


/***/ }),

/***/ 1648:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "Gw": () => (/* reexport */ settings/* getSettings */.Gw),
  "uR": () => (/* reexport */ settings/* isValidTheme */.uR),
  "uF": () => (/* binding */ background_migrateUserData),
  "Lt": () => (/* reexport */ settings/* setSetting */.Lt),
  "Xd": () => (/* reexport */ settings/* settings */.Xd),
  "Pg": () => (/* reexport */ settings/* settingsNotifier */.Pg)
});

// EXTERNAL MODULE: ./vendor/webext-sdk/dist/ewe-api.js
var ewe_api = __webpack_require__(209);
;// CONCATENATED MODULE: ./adblock-betafish/prefs/background/migration.js
/*
 * This file is part of AdBlock  <https://getadblock.com/>,
 * Copyright (C) 2013-present  Adblock, Inc.
 *
 * AdBlock is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 *
 * AdBlock is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with AdBlock.  If not, see <http://www.gnu.org/licenses/>.
 */
/* For ESLint: List any global identifiers used in this file below */
/* global browser  */
/**
 * @overview Migrates existing data from older versions
 */



async function unsubscribeToFilterList(url) {
  if (await ewe_api.subscriptions.has(url)) {
    await ewe_api.subscriptions.remove(url);
    return true;
  }
  return false;
}

/**
 * Migrates existing user data from older versions
 */
async function migrateUserData() {
  // We remove the AdBlock Custom filter list,
  // because it no longer serves any purpose
  unsubscribeToFilterList('https://cdn.adblockcdn.com/filters/adblock_custom.txt');

  // Remove any of the old DC filters,
  // Subscript to the new DC filter list
  const DISTRACTION_CONTROL_URL_LIST = [
    'https://easylist-downloads.adblockplus.org/v3/full/distraction-control-newsletter.txt',
    'https://cdn.adblockcdn.com/filters/distraction-control-newsletter.txt',
    'https://easylist-downloads.adblockplus.org/v3/full/distraction-control-push.txt',
    'https://cdn.adblockcdn.com/filters/distraction-control-push.txt',
    'https://easylist-downloads.adblockplus.org/v3/full/distraction-control-survey.txt',
    'https://cdn.adblockcdn.com/filters/distraction-control-survey.txt',
    'https://easylist-downloads.adblockplus.org/v3/full/distraction-control-video.txt',
    'https://cdn.adblockcdn.com/filters/distraction-control-video.txt',
  ];
  let subscribedTODC = false;
  for (const url of DISTRACTION_CONTROL_URL_LIST) {
    // eslint-disable-next-line no-await-in-loop
    subscribedTODC = await unsubscribeToFilterList(url);
  }

  if (subscribedTODC) {
    if (browser.runtime.getManifest().manifest_version === 2) {
      ewe_api.subscriptions.add('https://easylist-downloads.adblockplus.org/adblock_premium.txt');
    }
    if (browser.runtime.getManifest().manifest_version === 3) {
      ewe